<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129083114-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-129083114-2');
  </script>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@0.7.4"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.5/chartjs-plugin-annotation.js'></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <script src="world_data.js"></script>
  <script src="simulator.js"></script>
  <script src="optimizer.js"></script>

  <title>COVID-19 Dashboard - Sri Lanka</title>
  <meta name="description" content="Dashboard for COVID-19 cases in Sri Lanka"/>
  <meta name="keywords" content="COVID-19, Coronavirus, Sri Lanka">

</head>
<body>

  <div style="margin:0 auto; width:80%">

    <h2>Simulating the Coronavirus pandemic in Sri Lanka</h2>

    <div class="small" style="color:gray;"><b>Disclaimer</b>: This simulation tool is primarily intended for research and public awareness purposes. There are many uncertainties about the infection and transmission of COVID-19 and there are many limitations to this simple model.</div>
    <br>

    <div class="clearfix">
      <div class="column" id="chart_controls" style="width:20%;">
        <h3>Chart controls</h3>

        <div class="control">
          <div style="text-align:left; padding-bottom:3px;">Select country:</div>
          <select id="dropdown_country" style="min-height:30px" onchange="changeCountry(this.value)"></select>
        </div>

        <div class="control">
          <input type="checkbox" id="check_log_y" onchange="setLogYAxis(this.checked)">Log-scale y-axis</input>
        </div>

        <div class="control">
          <input type="checkbox" id="check_only_diagnosed" onchange="toggleDatasets()">Only show diagnosed cases</input>
        </div>

        <div class="control">
          <input type="checkbox" id="check_calibration_mode" onchange="toggleDatasets()">Turn on calibration mode</input>
        </div>

        <div class="control">
          <button type="button" class="small" id="reset_zoom" onclick="resetZoom()">Default view</button>
        </div>

        <br>
        <hr style="margin-top:10px;">

        <h3>Simulation controls</h3>
        <div class="control full">
            <input class"control" type="range" style="width: 90%;" id="slider_finalT" onmousemove="updateParameters()" min=5 max=270 step=1></input>
            <div class="small">Predict for <span id="slider_finalT_value"></span> days</div>
        </div>

        <div class="control full">
            <input class"control" type="range" style="width: 90%;" id="slider_param_error" onmousemove="updateParameters()" min=0 max=100 step=0.5></input>
            <div class="small">Uncertainty in parameters: <span id="slider_param_error_value"></span>%</div>
        </div>

        <!-- <div class="control full">
            <input class="control" type="range" id="slider_b1" onmousemove="updateParameters()" min=0 max=1 step=0.01></input>
            <br><div class="small tooltip">Transmission rate \(\beta_1\) =
              <span id="slider_b1_value"></span>
              <span class="tiny tooltiptext">Transmission from mildly infected to susceptible individuals</span>
            </div>
        </div> -->

        <!-- <div class="control">
            <br>
            <button type="button" class="small" id="btn_optimize" onclick="optimizeParameters()">Optimize parameters to data</button>
        </div> -->
      </div>
      <div class="column" style="width:80%;">

        <div id="canvas_container">
          <canvas class="full" id="chart_canvas"></canvas>
          <div class="teeny" id="legend" style="width:24em;">
            <center><b></b></center>
            <div class="clearfix">
              <div class="legend_column" style="width:50%; padding-right:5px;">
                <b><div id="legend_date" style="padding-bottom:5px"></div></b>
                <div class="exposed">Exposed</div>
                <div class="asymptomatic">Asymptomatic</div>
                <div class="mild_hidden">Mild - unreported</div>
                <div class="recovered_hidden">Recovered - unreported</div>
                <hr>
                <div class="recovered">Recovered</div>
                <div>Fatal</div>
                <div class="infected">Active diagnosed</div>
                <div class="mild" style="text-indent:1em;">- Mild</div>
                <div class="severe" style="text-indent:1em;">- Severe</div>
                <div class="critical" style="text-indent:1em;">- Critical</div>
                <hr>
                <div>Total diagnosed cases</div>
              </div>
              <div class="legend_column" style="width:25%; padding-right:5px;">
                <b><div class="legend_value" style="padding-bottom:5px">Predicted</div></b>
                <div class="legend_value exposed" id="legend_pred1">0</div>
                <div class="legend_value asymptomatic" id="legend_pred2">0</div>
                <div class="legend_value mild_hidden" id="legend_pred3">0</div>
                <div class="legend_value recovered_hidden" id="legend_pred4">0</div>
                <hr>
                <div class="legend_value recovered" id="legend_pred5">0</div>
                <div class="legend_value" id="legend_pred6">0</div>
                <div class="legend_value infected" id="legend_pred_infected">0</div>
                <div class="legend_value mild" id="legend_pred7">0</div>
                <div class="legend_value severe" id="legend_pred8">0</div>
                <div class="legend_value critical" id="legend_pred9">0</div>
                <hr>
                <div class="legend_value" id="legend_pred_total">0</div>
              </div>
              <div class="legend_column" style="width:25%;">
                <b><div class="legend_value" style="padding-bottom:5px">Actual</div></b>
                <div class="legend_value exposed">-</div>
                <div class="legend_value asymptomatic">-</div>
                <div class="legend_value mild_hidden">-</div>
                <div class="legend_value recovered_hidden">-</div>
                <hr>
                <div class="legend_value recovered" id="legend_true_recovered">0</div>
                <div class="legend_value" id="legend_true_fatal">0</div>
                <div class="legend_value infected" id="legend_true_infected">0</div>
                <div class="legend_value mild">-</div>
                <div class="legend_value severe">-</div>
                <div class="legend_value critical">-</div>
                <hr>
                <div class="legend_value" id="legend_true_total">0</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="clearfix">
      <div class="column" id="chart_controls" style="width:20%;">

        <div>
          <!-- <center> -->
            <div>Select a parameter to edit on graph:</div>
            <div class="control">
              <input type="radio" id="radio_beta1" name="control_chart_param" value="b1N" checked onchange="changeControlChartParameter(this.value)">
              <label for="radio_beta1" style="padding-right:10px;">
                <span class="tooltip">Transmission rate \(\beta_1\)
                  <span class="tiny tooltiptext">Transmission from mildly infected to susceptible individuals</span>
                </span>
              </label>
            </div>

            <div style="margin-top:5px;">
              <input type="radio" id="radio_beta2" name="control_chart_param" value="b2N" onchange="changeControlChartParameter(this.value)">
              <label for="radio_beta2" style="padding-right:10px;">
                <span class="tooltip">Transmission rate \(\beta_2\)
                  <span class="tiny tooltiptext">Transmission from severely infected to susceptible individuals</span>
                </span>
              </label>
            </div>

            <div style="margin-top:5px;">
              <input type="radio" id="radio_beta3" name="control_chart_param" value="b3N" onchange="changeControlChartParameter(this.value)">
              <label for="radio_beta3" style="padding-right:10px;">
                <span class="tooltip">Transmission rate \(\beta_3\)
                  <span class="tiny tooltiptext">Transmission from critical to susceptible individuals</span>
                </span>
              </label>
            </div>

            <div style="margin-top:5px;">
              <input type="radio" id="radio_c" name="control_chart_param" value="diag_frac" onchange="changeControlChartParameter(this.value)">
              <label for="radio_c">
                <span class="tooltip">Reported fraction \(c\)
                  <span class="tiny tooltiptext">Fraction of mildly infected cases that are reported</span>
                </span>
              </label>
            </div>

            <button type="button" class="control small" id="btn_reset_params" onclick="resetParameters()">Reset parameters</button>
        </div>

      </div>
      <div class="column" style="width:80%;">
        <div class="small" style="color:grey;">
          <span style="padding-left:4em;">
            <span class="tooltip">R0 value:
              <span class="tiny tooltiptext">Basic reproduction number</span>
            </span>&nbsp;<span id="R0_value">0.0</span>
          </span>
          <span style="float:right;">
            <span class="tooltip">Prediction error:
              <span class="tiny tooltiptext">This is an estimate of the error between the predicted data and the real data. Smaller error values indicate a better fit.</span>
            </span>&nbsp;<span id="prediction_error">0.0</span>
          </span>
        </div>
        <canvas class="full" id="control_chart_canvas"></canvas>
        <!-- <br> -->
        <center><div class="tiny" style="color:grey">Simulate the effect of interventions such as lockdowns and curfews by clicking and dragging points on the graph.</div></center>
      </div>
    </div>

    <br>

    <div class="para">
      <p>The COVID-19 pandemic has interrupted the day-to-day life of all Sri Lankans. At the time of writing, the entire country is in lockdown. As of now, due to strict interventions, the disease spread seems to have slowed down. However, it is not completely clear what we should expect in the future, especially when interventions change. To shed some light, we have developed an interactive tool to model the spread of COVID-19 in Sri Lanka using a classical SEIR (<b>S</b>usceptible → <b>E</b>xposed → <b>I</b>nfected → <b>R</b>emoved (i.e recovered and fatal) infectious disease model. We also modified the model to account for the Sri Lankan setting.
      </p>
    </div>

    <br>
    <h3>Model description</h3>

    <div class="para">

      <div class="clearfix">
        <div class="column" style="width:50%;">
          <p>
            In our model, the entire population is divided into the following classes:
            <ul>
              <li>\(S\) - Susceptible individuals</li>
              <li>\(E_0\) - Exposed individuals before they become infectious</li>
              <li>\(E_1\) - Exposed individuals after they are infectious</li>
              <li>\(I_0\) - Asymptomatic individuals</li>
              <li>\(I_{1D}\) - Infected individuals with mild symptoms who have been diagnosed</li>
              <li>\(I_{1U}\) - Infected individuals with mild symptoms who are unreported</li>
              <li>\(I_{1Q}\) - Infected individuals with mild symptoms who were directly quarantined upon entry</li>
              <li>\(I_2\) - Infected individuals with severe symptoms (require hospitalization)</li>
              <li>\(I_3\) - Infected individuals at critical stage (require ICU admission)</li>
              <li>\(R_D\) - Recovered individuals who were diagnosed positive</li>
              <li>\(R_U\) - Recovered individuals who are unreported</li>
              <li>\(D\) - Fatalities</li>
            </ul>
          </p>
        </div>
        <div class="column" style="width:50%;">
          <img src="./model_schematic.png" style="width:100%"></img>
          <center><figcaption class="tiny" style="margin-top:10px;">Schematic of model classes and rate parameters</figcaption></center>
        </div>
      </div>

      <p>
        Susceptible (\(S\)) individuals contract the disease from infected individuals in the classes \(E_1, I_0, I_{1D}, I_{1U}, I_{1Q}, I_2,\) and \(I_3\). They then move to the exposed class (\(E_0\)). After an incubation period (~3 days) in \(E_0\), they become infectious in the \(E_1\) class, and stay in the infectious-exposed class \(E_1\) for ~2 days. From \(E_1\), they can either move to an asymptomatic class, \(I_0\), or to the mild symptomatic classes, \(I_{1D}\) and \(I_{1U}\). The percentage of asymptomatic vs. symptomatic individuals is captured by the fraction \(f\), and is assumed to be 0.3 (i.e. 30% are asymptomatic). The percentage of diagnosed vs. unreported mild cases is captured by the fraction \(c\) (i.e. (\(100c\))% of mild cases get diagnosed).
      </p>
      <p>
        According to literature, roughly 81% of the symptomatic individuals (in \(I_{1D}\) and \(I_{1U}\)) recover after mild symptoms (in ~6 days) and move to the recovered classes (\(R_D\) and \(R_U\) respectively). The remaining 19% from \(I_{1D}\) and \(I_{1U}\) develop severe symptoms and move to the \(I_2\) class. Here we assume that individuals from the unreported mildly-infected class (\(I_{1U}\)) who develop severe infections get reported. Therefore, they also move to the same \(I_2\) class. These severe cases require hospitalization. About three-fourths from \(I_2\) recover after hospitalization (in ~4 days), but the remaining one-fourth develop critical symptoms and require ICU treatment. About 40% of the critical cases are fatal and the rest recover after ICU treatment (in ~10 days). These numbers were derived from the published literature of the COVID-19 spread in China, and were used to calculate the rate parameters, \(a_0, a_1, f, c, \gamma_0, \gamma_1, \gamma_2, \gamma_3, p_1, p_2,\) and \(\mu\).
      </p>
      <p>
        Next, we had a significant number of infected individuals (tested positive) who entered the country from abroad, but were strictly quarantined before they could infect others. We added a separate class \(I_{1Q}\) for these quarantined index individuals. We assumed that all these cases enter the country at the mildly infected stage (\(I_{1Q}\)), although it is possible that they enter during the exposed period as well. When we run the model, we add these cases to the population based on the date they tested positive.
      </p>

      <br>
      <h4>Governing equations</h4>
      <p>
        The system of coupled differential equations that model the evolution of the number of individuals in each of the 12 classes is given by:
        $$
          \begin{align}
          \dot{S} &= -\left( \beta_e E_1 + \beta_0 I_0 + \beta_{1D} I_{1D} + \beta_{1U} I_{1U} + \beta_2 I_2 + \beta_3 I_3 \right) S \\
          \dot{E}_0 &= \left( \beta_e E_1 + \beta_0 I_0 + \beta_{1D} I_{1D} + \beta_{1U} I_{1U} + \beta_2 I_2 + \beta_3 I_3 \right) S - a_0 E_0 \\
          \dot{E}_1 &= a_0 E_0 - a_1 E_1 \\
          \dot{I}_0 &= f a_1 E_1 - \gamma_0 I_0 \\
          \dot{I}_{1D} &= c(1-f) a_1 E_1 - (\gamma_1 + p_1) I_{1D} \\
          \dot{I}_{1U} &= (1-c)(1-f) a_1 E_1 - (\gamma_1 + p_1) I_{1U} \\
          \dot{I}_{1Q} &= q_{entry}(t) - (\gamma_1 + p_1) I_{1Q} \\
          \dot{I}_2 &= p_1 \left(I_{1D} + I_{1U} + I_{1Q} \right) - (\gamma_2 + p_2) I_2 \\
          \dot{I}_3 &= p_2 I_2 - (\gamma_3 + \mu) I_3 \\
          \dot{R}_D &= \gamma_1(I_{1D} + I_{1Q}) + \gamma_2 I_2 + \gamma_3 I_3 \\
          \dot{R}_U &= \gamma_0 I_0 + \gamma_1 I_{1U} \\
          \dot{D} &= \mu I_3
          \end{align}
        $$
      </p>
    </div>

    <br>
    <h3>Data sources</h3>

    <p class="small">
      <a href="http://www.epid.gov.lk/web/index.php?option=com_content&view=article&id=225&Itemid=518&lang=en" target="_blank">Situation reports</a> - Epidemiology unit, Ministry of Health, Sri Lanka
      <br><br>
      <a href="https://alhill.shinyapps.io/COVID19seir/" target="_blank">COVID-10 modeling app by Allison Hill</a>
      <br><br>
      <a href="https://pomber.github.io/covid19/timeseries.json" target="_blank">JSON time-series by pomber</a>
    </p>

    <br>
    <h3>About</h3>

    <p class="small">
      This model was developed by <a href="https://wadduwagelab.com/" target="_blank">Dushan Wadduwage</a> (<a href="mailto:wadduwage@fas.harvard.edu">wadduwage@fas.harvard.edu</a>), <a href="https://www.linkedin.com/in/savithru/" target="_blank">Savithru Jayasinghe</a> (<a href="mailto:savithru@mit.edu">savithru@mit.edu</a>), and <a href="https://medicine.yale.edu/profile/suneth_agampodi/" target="_blank">Suneth Agampodi</a> (<a href="mailto:suneth.agampodi@yale.edu">suneth.agampodi@yale.edu</a>).
      <br><br>
      The Javascript code behind this web application is available on <a href="https://github.com/savithru-j/COVID-19-SL" target="_blank">Github</a> under an <a href="https://opensource.org/licenses/MIT" target="_blank">MIT license</a>.
    </p>

    <br>
    <b>Acknowledgements</b>
    <ul style="padding-top:0px">
      <li><a href="https://twitter.com/alison_l_hill" target="_blank">Allison Hill</a> for her advice and feedback on early versions of the model.</li>
      <li>Buddhi Prabhath for integrating data from all countries into the code.</li>
      <li><a href="https://alt.army.lk/covid19/" target="_blank">National Operation Centre for Prevention of COVID-19 Outbreak</a> in Sri Lanka for sharing data and strategy related detail.</li>
    </ul>

    <br>
    <div class="tiny" style="text-align:right; color:grey">This simulation tool is intended for research purposes, and is provided freely without warranty of any kind.</div>

  </div>

  <div style="height:30px"></div>

</body>
</html>
